<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard SOP Internal BPS</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root{
  --primary:#1E3A8A;
  --primary-soft:#DBEAFE;
  --accent:#F59E0B;
}

body{
  margin:0;
  font-family:"Segoe UI",system-ui,sans-serif;
  background:linear-gradient(135deg,#f8fafc,#eef2f7);
  color:#1f2937;
}

canvas{
  width:100%!important;
  height:260px!important;
}

header{
  background:linear-gradient(135deg,#1E3A8A,#2563EB);
  padding:24px;
  text-align:center;
  box-shadow:0 8px 20px rgba(30,58,138,.35);
}
header img{height:140px}
header h1{color:#fff;margin:10px 0 0}
header p{color:#DBEAFE;font-size:18px;margin:4px 0 0}

nav{
  background:#fff;
  padding:12px 24px;
  display:flex;
  justify-content:space-between;
  border-bottom:1px solid #e5e7eb;
}

nav button{
  background:var(--primary);
  color:#fff;
  border:none;
  padding:8px 14px;
  border-radius:10px;
  cursor:pointer;
  font-weight:600;
}

main{padding:28px}

.dashboard{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(320px,1fr));
  gap:24px;
}

.card{
  background:rgba(255,255,255,.9);
  border-radius:18px;
  padding:20px;
  box-shadow:0 12px 30px rgba(30,58,138,.18);
}

.total-box{
  margin-top:14px;
  padding:14px;
  background:linear-gradient(135deg,#fff,var(--primary-soft));
  border-radius:14px;
  display:flex;
  gap:14px;
  border-left:5px solid var(--primary);
}

.total-box i{
  font-size:28px;
  color:var(--primary);
}

.total-box strong{
  font-size:26px;
  color:var(--primary);
}

footer{
  margin-top:36px;
  text-align:center;
  padding:14px;
  background:#1E3A8A;
  color:#e5e7eb;
}
</style>
</head>

<body>

<header>
  <img src="https://lh3.googleusercontent.com/d/1FmC7IA0IFPIagwnYJlj7m9VkNZEdFkMJ=s300">
  <h1>Dashboard SOP</h1>
  <p>BPS Kabupaten Belitung</p>
</header>

<nav>
  <span>Monitoring SOP Internal</span>
  <button onclick="toggleFullscreen()">
    <i class="fas fa-expand"></i> Fullscreen
  </button>
</nav>

<main>
<div class="dashboard">
  <div class="card">
    <h3>SOP 2024</h3>
    <canvas id="chart2024"></canvas>
    <div class="total-box">
      <i class="fas fa-folder"></i>
      <div>Total SOP 2024<br><strong id="t2024">0</strong></div>
    </div>
  </div>

  <div class="card">
    <h3>SOP 2025</h3>
    <canvas id="chart2025"></canvas>
    <div class="total-box">
      <i class="fas fa-folder"></i>
      <div>Total SOP 2025<br><strong id="t2025">0</strong></div>
    </div>
  </div>
</div>
</main>

<footer>&copy; 2025 Dashboard SOP Internal BPS</footer>

<script>
function toggleFullscreen(){
  if(!document.fullscreenElement){
    document.documentElement.requestFullscreen();
  }else{
    document.exitFullscreen();
  }
}

/* === CHART SHADOW === */
const shadow={
  id:'shadow',
  beforeDraw(c){
    const x=c.ctx;
    x.save();
    x.shadowColor='rgba(0,0,0,.25)';
    x.shadowBlur=10;
    x.shadowOffsetX=3;
    x.shadowOffsetY=3;
  },
  afterDraw(c){c.ctx.restore();}
};

/* === LOAD CSV === */
fetch("https://docs.google.com/spreadsheets/d/1Q145QmnMj88m0HVS5VClScWW0Qt0qugi/export?format=csv&gid=1210948375")
.then(r=>r.text())
.then(csv=>{
  const rows = csv
    .trim()
    .split("\n")
    .slice(1)
    .map(r=>r.split(",")); // FIX delimiter

  const label = v => String(v||"").replace(/"/g,"").trim();
  const num = v => Number(
    String(v||"0").replace(/"/g,"").replace(/\./g,"").replace(",",".")
  ) || 0;

  const labels = rows.map(r=>label(r[0]));
  const d24 = rows.map(r=>num(r[1]));
  const d25 = rows.map(r=>num(r[2]));

  t2024.innerText = d24.reduce((a,b)=>a+b,0);
  t2025.innerText = d25.reduce((a,b)=>a+b,0);

  new Chart(chart2024,{
    type:'bar',
    plugins:[shadow],
    data:{labels,datasets:[{data:d24,backgroundColor:'#1E40AF'}]},
    options:{responsive:true,plugins:{legend:{display:false}},scales:{y:{beginAtZero:true}}}
  });

  new Chart(chart2025,{
    type:'bar',
    plugins:[shadow],
    data:{labels,datasets:[{data:d25,backgroundColor:'#2563EB'}]},
    options:{responsive:true,plugins:{legend:{display:false}},scales:{y:{beginAtZero:true}}}
  });
});
</script>

</body>
</html>
