<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SOP Generator BPS</title>

<style>
body{
  font-family:"Segoe UI", Arial, sans-serif;
  background:#f3f4f6;
  margin:0;
  padding:24px;
}
.container{
  display:grid;
  grid-template-columns:420px 1fr;
  gap:24px;
}
.card{
  background:#fff;
  padding:20px;
  border-radius:12px;
  box-shadow:0 6px 18px rgba(0,0,0,.08);
}
input, textarea{
  width:100%;
  padding:8px;
  margin-bottom:8px;
  border-radius:6px;
  border:1px solid #ccc;
  font-size:14px;
}
button{
  padding:8px 12px;
  border:none;
  border-radius:6px;
  cursor:pointer;
}
.btn{background:#1E3A8A;color:#fff}
.btn-add{background:#059669;color:#fff;font-size:13px}

.page{
  background:#fff;
  padding:28px;
  border-radius:12px;
}
table{
  width:100%;
  border-collapse:collapse;
  font-size:13px;
}
th,td{
  border:1px solid #111827;
  padding:6px;
}
th{
  background:#e5e7eb;
  text-align:center;
}
.center{text-align:center}

.no-print{display:table-cell}

@media print{
  body{background:#fff;padding:0}
  .container{grid-template-columns:1fr}
  .card,.no-print{display:none !important}
}
</style>
</head>

<body>
<div class="container">

<!-- ================= FORM ================= -->
<div class="card">
<h3>DATA SOP</h3>

<input id="nomor" placeholder="Nomor SOP">
<input id="buat" placeholder="Tanggal Pembuatan">
<input id="revisi" placeholder="Tanggal Revisi">
<input id="efektif" placeholder="Tanggal Efektif">
<input id="judul" placeholder="Judul SOP">

<textarea id="dasar" placeholder="Dasar Hukum"></textarea>
<textarea id="kualifikasi" placeholder="Kualifikasi Pelaksana"></textarea>
<textarea id="keterkaitan" placeholder="Keterkaitan"></textarea>
<textarea id="peralatan" placeholder="Peralatan / Perlengkapan"></textarea>
<textarea id="peringatan" placeholder="Peringatan"></textarea>
<textarea id="pencatatan" placeholder="Pencatatan & Pendataan"></textarea>

<hr>

<h4>Tambah Pelaksana</h4>
<input id="pelaksanaBaru" placeholder="Contoh: OPD / Walidata">
<button class="btn-add" onclick="tambahPelaksana()">+ Tambah Pelaksana</button>

<hr>

<h4>Tata Laksana</h4>
<table>
<tr>
  <th>Kegiatan</th>
  <th>Pelaksana</th>
  <th>Kelengkapan</th>
  <th>Waktu</th>
  <th>Output</th>
</tr>
<tr>
  <td><textarea id="kegiatan"></textarea></td>
  <td id="formPelInput"></td>
  <td><input id="kelengkapan"></td>
  <td><input id="waktu"></td>
  <td><input id="output"></td>
</tr>
</table>

<button class="btn-add" onclick="tambahKegiatan()">+ Tambah Kegiatan</button>

<hr>
<button class="btn" onclick="render()">Update Preview</button>
<button onclick="window.print()">Cetak / PDF</button>
</div>

<!-- ================= PREVIEW ================= -->
<div class="page">

<table>
<tr>
  <td rowspan="4" class="center"><strong>BPS<br>KABUPATEN BELITUNG</strong></td>
  <td>NOMOR SOP</td><td>: <span id="pNomor"></span></td>
</tr>
<tr><td>TGL. PEMBUATAN</td><td>: <span id="pBuat"></span></td></tr>
<tr><td>TGL. REVISI</td><td>: <span id="pRevisi"></span></td></tr>
<tr><td>TGL. EFEKTIF</td><td>: <span id="pEfektif"></span></td></tr>
</table>

<h2 id="pJudul" style="text-align:center"></h2>

<table>
<tr><th>DASAR HUKUM</th><th>KUALIFIKASI PELAKSANA</th></tr>
<tr><td id="pDasar"></td><td id="pKualifikasi"></td></tr>
</table><br>

<table>
<tr><th>KETERKAITAN</th><th>PERALATAN / PERLENGKAPAN</th></tr>
<tr><td id="pKeterkaitan"></td><td id="pPeralatan"></td></tr>
</table><br>

<table>
<tr><th>PERINGATAN</th><th>PENCATATAN DAN PENDATAAN</th></tr>
<tr><td id="pPeringatan"></td><td id="pPencatatan"></td></tr>
</table>

<h3>TATA LAKSANA</h3>

<table>
<thead>
<tr>
  <th rowspan="2">No</th>
  <th rowspan="2">Kegiatan</th>
  <th id="pelHeader">Pelaksana</th>
  <th colspan="3">Mutu Baku</th>
  <th rowspan="2">Ket</th>
  <th rowspan="2" class="no-print">Aksi</th>
</tr>
<tr id="pelSub">
  <th>Kelengkapan</th>
  <th>Waktu</th>
  <th>Output</th>
</tr>
</thead>
<tbody id="tbody"></tbody>
</table>

</div>
</div>

<script>
let pelaksana=[];
let kegiatanData=[];

function tambahPelaksana(){
  if(!pelaksanaBaru.value) return;
  pelaksana.push(pelaksanaBaru.value);
  pelaksanaBaru.value="";
  renderPelaksana();
}

function renderPelaksana(){
  formPelInput.innerHTML="";
  pelaksana.forEach((p,i)=>{
    formPelInput.innerHTML+=`
      <label><input type="checkbox" data-i="${i}"> ${p}</label><br>`;
  });
  renderTable();
}

function tambahKegiatan(){
  if(!kegiatan.value) return;
  let pel={};
  document.querySelectorAll("#formPelInput input").forEach(cb=>{
    pel[cb.dataset.i]=cb.checked;
    cb.checked=false;
  });
  kegiatanData.push({
    kegiatan:kegiatan.value,
    pelaksana:pel,
    kelengkapan:kelengkapan.value,
    waktu:waktu.value,
    output:output.value
  });
  kegiatan.value=kelengkapan.value=waktu.value=output.value="";
  renderTable();
}

function hapusKegiatan(i){
  if(!confirm("Hapus baris kegiatan ini?")) return;
  kegiatanData.splice(i,1);
  renderTable();
}

function render(){
  pNomor.textContent=nomor.value;
  pBuat.textContent=buat.value;
  pRevisi.textContent=revisi.value;
  pEfektif.textContent=efektif.value;
  pJudul.textContent=judul.value;

  pDasar.innerHTML=dasar.value.replace(/\n/g,"<br>");
  pKualifikasi.innerHTML=kualifikasi.value.replace(/\n/g,"<br>");
  pKeterkaitan.innerHTML=keterkaitan.value.replace(/\n/g,"<br>");
  pPeralatan.innerHTML=peralatan.value.replace(/\n/g,"<br>");
  pPeringatan.innerHTML=peringatan.value.replace(/\n/g,"<br>");
  pPencatatan.innerHTML=pencatatan.value.replace(/\n/g,"<br>");
}

function renderTable(){
  pelHeader.colSpan=pelaksana.length||1;
  pelSub.innerHTML=pelaksana.map(p=>`<th>${p}</th>`).join("")+
    `<th>Kelengkapan</th><th>Waktu</th><th>Output</th>`;

  tbody.innerHTML="";
  kegiatanData.forEach((d,i)=>{
    let kolPel=pelaksana.map((_,idx)=>
      `<td class="center">${d.pelaksana[idx]?"✓":""}</td>`
    ).join("");

    tbody.innerHTML+=`
    <tr>
      <td class="center">${i+1}</td>
      <td>${d.kegiatan}</td>
      ${kolPel}
      <td>${d.kelengkapan}</td>
      <td class="center">${d.waktu}</td>
      <td>${d.output}</td>
      <td></td>
      <td class="center no-print">
        <button onclick="hapusKegiatan(${i})"
          style="background:#dc2626;color:#fff;padding:4px 6px;border-radius:4px">
          ✕
        </button>
      </td>
    </tr>`;
  });
}
</script>
</body>
</html>
